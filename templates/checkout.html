@app.route("/checkout")
def checkout():
    cart_ids = session.get("cart", [])
    if not cart_ids:
        flash("Cart is empty. Please add a plan first.", "error")
        return redirect(url_for("home"))

    cart_items = [get_plan_by_id(pid) for pid in cart_ids if get_plan_by_id(pid)]
    if not cart_items:
        flash("Invalid items in cart.", "error")
        return redirect(url_for("home"))

    total = sum(item["price"] for item in cart_items)

    return render_template("checkout.html",
                           cart=cart_items,
                           total=total,
                           qr_url=url_for("static", filename="img/qr.png"))
